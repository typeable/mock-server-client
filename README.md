## About

The package is the client library for the [mock server](https://www.mock-server.com/). The source code is
generated by the [openapi3-code-generator](https://hackage.haskell.org/package/openapi3-code-generator), specifically its patched version.

## How to regenerate

```
cd codegen && ./regen.sh
```

It requires the `nix` to be installed in your system because it uses the
`openapi3-code-generator` built by the `nix`.

After regeneration you will see some `.hs` files changed. This is because some
parts of the libary are modified by hand to make the more usable.

## Files

### The `codegen` dir

* `regen.sh` is the simple script to regenerate the whole package.
* `shell.nix` a shell in which the `regen.sh` calls the `openapi3-code-generator` to regenerate the
* `mock-server-openapi-5.13.x-swagger.yaml` not the original file as you might
  think. The thing is that the `openapi3-code-generator` does not support all
  the features of the OpenAPI3 standard correctly, so it is
  hand-postprocessed. It was originally downloaded from [here](https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.13.x) and fixed.
* `src` contails the generted code, but not exactly. Some of the parts of the
  generted code was not very pleasant, so it was fixed too.

### What will happen if you just call the `regen.sh`?

It will build the `openapi3-code-generator` in `nix` and regenerate the whole
Haskell source code. You will see that the code was changed, because as
mentioned earlier the original code was slightly modified, so watch your commits.

## How the to update the package to the new version of the `mock-server`?

* Commit all changes in git
* Run the `regen.sh` and regenerate the whole package
* Run `git diff -p > src.patch` and save the manual changes made to the source code
* Download the [original spec](https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.13.x) in place of our patched spec file
* Run the `git diff -- codegen/mock-server-openapi-5.13.x-swagger.yaml -p > spec.patch`
* Download the [new spec](https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi) and put it in place of the old one
* Try to `git apply spec.patch` to the newer version of the spec to apply manual
  changes to the new spec. If somethig goes wrong use AI to fix it for you, heh.
* Fix the `regen.sh` and rename the `mock-server-openapi-5.13.x-swagger.yaml` to
  the newer version.
* `git commit -m 'dangerous action'`
* Run the `regen.sh` so you will hopefuly have a new version of the client code
  generated.
* `git apply src.patch` to apply manual patches to the new version.
